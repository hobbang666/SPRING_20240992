<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>New 블로그 게시판</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
    <div class="container">
        <!-- 로그인 정보 표시 영역 (이전 단계에서 수정 완료) -->
        <div class="d-flex justify-content-between align-items-center mt-4 p-3 border rounded bg-light">
            <h1 class="m-0">블로그 게시판(new)</h1>
            <div class="text-right">
                <span th:if="${email}" class="font-weight-bold text-primary" th:text="${email} + '님 환영합니다.'"></span>
                <a th:if="${email}" class="btn btn-sm btn-outline-danger ml-3" th:href="@{/api/logout}">로그아웃</a>
                <a th:unless="${email}" class="btn btn-sm btn-outline-primary ml-3" th:href="@{/member_login}">로그인</a>
            </div>
        </div>

        <h2 class="mt-5">게시글 목록</h2>


        <!-- 게시글 테이블 -->
        <div class="mt-3">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <!-- 게시글 목록에 ID, 제목, 작성자 필드를 명확하게 추가하는 것이 좋습니다. -->
                        <th>ID</th>
                        <th>제목</th>
                        <th>작성자</th>
                        <th>글내용</th>
                        <th>관리</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 게시글 목록 반복 출력 -->
                    <tr th:each="board : ${boards}">
                        <!-- 게시글 내용 출력 필드 -->
                        <td th:text="${board.id}"></td>
                        <td><a th:href="@{/board_view/{id}(id=${board.id})}" th:text="${board.title}">제목</a></td>
                        <td th:text="${board.user}">작성자 이메일</td>
                        <td th:text="${board.content}">글 내용</td>

                        <!-- 🌟 권한 확인 및 버튼 출력 영역 🌟 -->
                        <td style="white-space: nowrap;">
                            <!-- ThymeLeaf 조건문: 게시글 작성자(board.user)와 로그인 사용자(email)가 같을 때만 출력 -->
                            <div th:if="${board.user} == ${email}">

                                <!-- 수정 버튼 -->
                                <a class="btn btn-warning btn-sm" th:href="@{/board_edit/{id}(id=${board.id})}">수정</a>

                                <!-- 삭제 폼 -->
                                <form th:action="@{/api/board_delete/{id}(id=${board.id})}" method="post"
                                    style="display:inline;">
                                    <input type="hidden" name="_method" value="delete">
                                    <button type="submit" class="btn btn-danger btn-sm"
                                        onclick="return confirm('정말로 삭제하시겠습니까?');">삭제</button>
                                </form>
                            </div>
                            <!-- 작성자가 아닐 경우 "-" 표시 -->
                            <div th:unless="${board.user} == ${email}">
                                -
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>

</html>